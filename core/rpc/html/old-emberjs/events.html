<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                    "http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD><title>rpc events</title>
<link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery.ui.all.css" rel="stylesheet"></link>
<script src="http://code.jquery.com/jquery-latest.js"></script>
<SCRIPT>

var subscription = "";
var url = "/jsonrpc";

function displayEvent(response) {

	if (response.result) { 
		var inventory_div = document.createElement('div');
		inventory_div.innerHTML = '<br>';
		inventory_div.id = 'inventory_div';
		document.body.appendChild(inventory_div);
		if (response.result.event == 'event.environment.timechanged') {
			inventory_div.innerHTML = inventory_div.innerHTML + " " + response.result.event + " " + response.result.hour+ ":" + response.result.minute +  "<br>";
		} else {
			inventory_div.innerHTML = inventory_div.innerHTML + " " + response.result.event + "<br>";

		}
	}
	console.log(response.result)
	getevent();

}
function getevent() {
	var request = {};
	request.method = "getevent";
	request.params = {};
	request.params.uuid = subscription;
	request.id = 1;
	request.jsonrpc = "2.0";

	$.post(url, JSON.stringify(request), displayEvent, "json");
}


function handleSubscribe(response) {

	if (response.result) { 
		subscription = response.result;
		console.log(subscription);
		var inventory_div = document.createElement('div');
		inventory_div.innerHTML = '<br>';
		inventory_div.id = 'inventory_div';
		document.body.appendChild(inventory_div);
		inventory_div.innerHTML = inventory_div.innerHTML + "Subscription uuid: " + subscription + "<br>";
		getevent();
	}

}
 
function subscribe() {
	var request = {};
	request.method = "subscribe";
	request.id = 1;
	request.jsonrpc = "2.0";

	$.post(url, JSON.stringify(request), handleSubscribe, "json");
}

$(document).ready(function() {

		subscribe();
});


</SCRIPT>
</HEAD>
<BODY>
<div>
<h1>ago control event log</h1>
</BODY>
</HEAD>
