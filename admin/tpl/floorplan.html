<%inherit file="base.html"/>
<%block name="title">ago control floorplan</%block>

<script type="text/javascript">
	var inventory = ${inventory};

	function set_dragable(elem) {
		elem.draggable({
				containment: "#plan #devices",
				stack: "#devices div",
				cursor: "move",
				snap: ".device",
				revert: true
			});
	}

	$(document).ready(function () {
         $( "#dialog-form" ).dialog({
            autoOpen: true,
            height: 300,
            width: 350,
            modal: true,
            buttons: {
                "Continue": function() {
                    var w = parseInt($("#width").val());
                    var h = parseInt($("#height").val());
                    if (w == 0 || h == 0 || isNaN(w) || isNaN(h)) {
                        alert("Invalid size");
                        return;
                    }
                    $("#plan").width(w);
                    $("#plan").height(h);
                    $(this).dialog("close");
                    init_plan();
                }
           }
         });
	});
	
	function init_plan() {
		for (var i = 0; i < inventory.length; i++) {
			var elem = $('<div class="device" style="border: 1px dashed #000; float: left; width: 150px; height: 50px; margin: 5px;">' +
						  inventory[i].name + " (" + inventory[i].devicetype + ") </div>")
			elem.appendTo("#devices");
			set_dragable(elem);
		}

		$('<br style="clear:both" />').appendTo("#devices");

		$("#devices").droppable({
			accept: ".device",
			drop: function(event, ui) {
				 ui.draggable.css("position", "auto");
				 ui.draggable.css("left", "auto");
				 ui.draggable.css("top", "auto");

				 ui.draggable.draggable('option','revert', false);
				 ui.draggable.draggable('destroy');
				 set_dragable(ui.draggable);
			}
		});

		$("#plan").droppable({
			accept: ".device",
			drop: function(event, ui) {
				ui.draggable.draggable('option','revert', false);
				ui.draggable.draggable('destroy');
				set_dragable(ui.draggable);
			}
		});	 
		
		return false;   
	}
</script>
<div id="dialog-form" title="Floor Plan Settings">
    <form>
        <fieldset>
        <label for="width">Plan width:</label>
        <input type="text" name="width" id="width" /><br />
        <label for="height">Plan height:</label>
        <input type="text" name="height" id="height" /><br />
    </form>
</div>

<div id="devices">
</div>
<br style="clear:both" />
<div id="plan" style="width:100%;border:1px solid; height: 800px;">
</div>
