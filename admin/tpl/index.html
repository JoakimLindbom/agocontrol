<%inherit file="base.html"/>
<%block name="title">ago control start page</%block>

<div id="accordion">
<h3>Dashboard</h3>
<div id="dashboard">
% for device in inventory:
    % if device["devicetype"] == "switch":
	<div class="comicitem">
	  <div class="toogleswitch" state="${device["state"]}" ${devicestate(device["state"])} rel="${device["id"]}"><p class="devicename">${device["name"]}</p></div>
	</div>
    % endif
    % if device["devicetype"] == "dimmer":
	<div class="comicitem">
	  <div class="dimmerwrap">
	    <div class="toogleswitch" state="${device["state"]}" ${devicestate(device["state"])} rel="${device["id"]}"><p class="devicename">${device["name"]}</p></div>
	    <div class="slider level" rel="${device["id"]}" def_value="${device["state"]}"></div>
	  </div>
	</div>
    % endif
% endfor
<br clear="left">
</div>

% for room in rooms:
	<h3>${room["name"]}</h3>
	<div>
		<table>
		% for device in inventory:
                        % if room["id"] == device["room"]:
				${makerow(device)}
			% endif
		% endfor
		</table>
	</div>
% endfor
</div>
<%def name="makerow(device)">
        <tr>
                <td>${device["id"]}</td><td>${device["name"]}</td><td>${device["devicetype"]}</td><td>${device["state"]}</td><td>${devicetype_commands(device["devicetype"],device["id"],device["state"])}</td>
        </tr>
</%def>
<%def name="devicestate(state)">
% if state == 0:
command="off"\
% elif state == "0":
command="off"\
% else:
command="on"\
% endif
</%def>
<%def name="devicetype_commands_values(devicetype)">
% if devicetype in schema["devicetypes"]:
  % for command in schema["devicetypes"][devicetype]["commands"]:
        ${command},
  % endfor
% endif
</%def>
<%def name="devicetype_commands(devicetype,uuid,state)">
% if schema:
	% if "devicetypes" in schema:
		% if devicetype in schema["devicetypes"]:
		  % for command in schema["devicetypes"][devicetype]["commands"]:
		      % if command == "setlevel":
			<div class="slider level" rel="${uuid}" def_value="${state}"></div>
		      % else:
			% if command in schema["commands"]:
			<button class="switch_${command}" rel="${uuid}">${schema["commands"][command]["name"]}</button>
			% else:
			<button class="switch_${command}" rel="${uuid}">name missing from schema</button>
			% endif
		      % endif
		  % endfor
		% endif
	% endif
% endif
</%def>
